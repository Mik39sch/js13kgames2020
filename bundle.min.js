!function(t){var e={};function i(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class a{constructor(){this.pathWidth=CHARACTER_DATA.player.length+1;let t=getRandomInt(100,200);getRandomInt(0,100)%2==0?this.createMazeAsTorneko(t,t):this.createMaze(t,t),this.stageHeight=this.mImageData.length*PIXEL_SIZE,this.stageWidth=this.mImageData[0].length*PIXEL_SIZE}addRect(t,e,i,a){this.rectList||(this.rectList=[]);let n={minX:t,minY:e,maxX:i,maxY:a,room:null};return this.rectList.push(n),n}addRoom(t,e,i,a){this.roomList||(this.roomList=[]);let n={minX:t,minY:e,maxX:i,maxY:a};return this.roomList.push(n),n}addPath(t,e,i){this.pathList||(this.pathList=[]);let a={direction:t,rect0:e,rect1:i};this.pathList.push(a)}splitRect(t){if(t.maxY-t.minY<=2*MINIMUM_ROOM_SIZE||t.maxX-t.minX<=2*MINIMUM_ROOM_SIZE)return;let e=this.addRect(t.minX,t.minY,t.maxX,t.maxY);if(t.doneY){if(!t.doneX){let i=getRandomInt(t.minX+MINIMUM_ROOM_SIZE,t.maxX-MINIMUM_ROOM_SIZE);t.maxX=i,e.minX=i,this.addPath("w",t,e)}}else{let i=getRandomInt(t.minY+MINIMUM_ROOM_SIZE,t.maxY-MINIMUM_ROOM_SIZE);t.maxY=i,e.minY=i,this.addPath("h",t,e)}this.splitRect(t),this.splitRect(e)}makeRoom(){for(let t=0;t<this.rectList.length;t++){const e=this.rectList[t];let i=getRandomInt(MINIMUM_ROOM_SIZE,e.maxX-e.minX-2*ROOM_MARGIN+1),a=getRandomInt(MINIMUM_ROOM_SIZE,e.maxY-e.minY-2*ROOM_MARGIN+1),n=getRandomInt(e.minX+ROOM_MARGIN,e.maxX-ROOM_MARGIN-i+1),s=getRandomInt(e.minY+ROOM_MARGIN,e.maxY-ROOM_MARGIN-a+1);e.room=this.addRoom(n,s,n+i,s+a)}}line(t,e,i,a){let n=Math.min(t,i),s=Math.max(t,i),r=Math.min(e,a),m=Math.max(e,a);for(let o=n;o<=s;o++){let n,s;t<=i&&e>=a?(n=o,s=m):t>i&&e>a||t>i&&e<=a?(n=o,s=r):t<=i&&e<a&&(n=o,s=m),this.mImageData[n][s]="0",this.mImageData[n][s+1]="0",this.mImageData[n][s+2]="0",this.mImageData[n][s+3]="0",this.mImageData[n][s-1]="0",this.mImageData[n][s-2]="0",this.mImageData[n][s-3]="0"}for(let o=r;o<=m;o++){let r,m;t<=i&&e>=a||t>i&&e>a?(r=s,m=o):(t>i&&e<=a||t<=i&&e<a)&&(r=n,m=o),this.mImageData[r][m]="0",this.mImageData[r+1][m]="0",this.mImageData[r+2][m]="0",this.mImageData[r+3][m]="0",this.mImageData[r-1][m]="0",this.mImageData[r-2][m]="0",this.mImageData[r-3][m]="0"}}createMazeAsTorneko(t,e){this.splitRect(this.addRect(0,0,t,e)),this.makeRoom(),this.mImageData=[];for(let i=0;i<e+1;i++){let e=[];for(let i=0;i<t+1;i++)e.push("A");this.mImageData.push(e)}for(let t=0;t<this.roomList.length;t++){const e=this.roomList[t];for(let t=e.minX;t<=e.maxX;t++)for(let i=e.minY;i<=e.maxY;i++)this.mImageData[t][i]="0";for(let t=e.minX,i=e.minY;t<=e.maxX;t++)this.mImageData[t][i]="A";for(let t=e.minX,i=e.maxY;t<=e.maxX;t++)this.mImageData[t][i]="A";for(let t=e.minX,i=e.minY;i<=e.maxY;i++)this.mImageData[t][i]="A";for(let t=e.maxX,i=e.minY;i<=e.maxY;i++)this.mImageData[t][i]="A"}for(let t=0;t<this.pathList.length;t++){const e=this.pathList[t];let i,a,n,s;switch(e.direction){case"w":i=e.rect0.maxX,a=getRandomInt(e.rect0.room.minY+1,e.rect0.room.maxY),n=e.rect1.minX,s=getRandomInt(e.rect1.room.minY+1,e.rect1.room.maxY),this.line(i,a,n,s),this.line(e.rect0.room.maxX,a,i,a),this.line(e.rect1.room.minX,s,n,s);break;case"h":i=getRandomInt(e.rect0.room.minX+1,e.rect0.room.maxX),a=e.rect0.maxY,n=getRandomInt(e.rect1.room.minX+1,e.rect1.room.maxX),s=e.rect1.minY,this.line(i,a,n,s),this.line(i,e.rect0.room.maxY,i,a),this.line(n,e.rect1.room.minY,n,s)}}}createMaze(t,e){0!=t%this.pathWidth&&(t+=this.pathWidth-1-t%this.pathWidth),0!=e%this.pathWidth&&(e+=this.pathWidth-1-e%this.pathWidth),this.mImageData=[];for(let i=0;i<t+2;i++){this.mImageData[i]=[];for(let a=0;a<e+2;a++)this.mImageData[i][a]=0===i||0===a||i===t+1||a===e+1?"A":"0"}for(let i=this.pathWidth;i<t;i+=this.pathWidth)for(let t=this.pathWidth;t<e;t+=this.pathWidth)for(this.mImageData[i][t]="A";;){let e,a=3;this.pathWidth===t&&(a=2),e=getRandomInt(0,a);let n=i,s=t;switch(e){case 0:n++;break;case 1:s++;break;case 2:n--;break;case 3:s--}if("A"!=this.mImageData[n][s]){this.mImageData[n][s]="A";for(let t=0;t<this.pathWidth-1;t++){switch(e){case 0:n++;break;case 1:s++;break;case 2:n--;break;case 3:s--}this.mImageData[n][s]="A"}break}}}}class n{constructor(t,e){if(CHARACTER_DATA[t]||(t="player"),this.mImageData=CHARACTER_DATA[t],this.posY=1,this.posX=1,this.newDirection=null,this.currentDirection=e,this.directionConst={top:{top:0,right:1,down:2,left:3},right:{top:3,right:0,down:1,left:2},down:{top:2,right:3,down:0,left:1},left:{top:1,right:2,down:3,left:0}},"top"!=e){const t=this.directionConst.top[e];if(t>0)for(let e=0;e<t;e++)this.turn()}}turn(){let t=JSON.parse(JSON.stringify(this.mImageData));for(let e=0;e<this.mImageData.length;e++)for(let i=0;i<this.mImageData[e].length;i++)t[e][i]=this.mImageData[this.mImageData.length-i-1][e];this.mImageData=t}}class s{constructor(t,e){this.mCanvas=t,this.prevTimestamp=0,this.stage=e,this.currentFrame=JSON.parse(JSON.stringify(this.stage.mImageData)),this.player=new n("player","top"),this.putCharacter(this.player),this.enemies={};for(let t=0;t<5;t++)this.enemies[t]=new n("enemy","down"),this.putCharacter(this.enemies[t]);this.enemyMove=5,window.addEventListener("keydown",this.keyDown.bind(this)),window.addEventListener("keyup",this.keyUp.bind(this));let i=this;document.getElementById("up").onclick=function(){i.player.newDirection="up"},document.getElementById("down").onclick=function(){i.player.newDirection="down"},document.getElementById("left").onclick=function(){i.player.newDirection="left"},document.getElementById("right").onclick=function(){i.player.newDirection="right"},this.currentFrame=JSON.parse(JSON.stringify(this.stage.mImageData))}playing(t){if((t-this.prevTimestamp)/1e3<=FRAME_TIME)window.requestAnimationFrame(this.playing.bind(this));else{this.currentFrame=JSON.parse(JSON.stringify(this.stage.mImageData)),this.moveCharacter(this.player);for(let t=0;t<Object.keys(this.enemies).length;t++){if(this.enemies[t].newDirection=null,0===this.enemyMove){let e=[null,"top","down","right","left"];this.enemies[t].newDirection=e[getRandomInt(0,4)]}this.moveCharacter(this.enemies[t])}0===this.enemyMove?this.enemyMove=5:this.enemyMove--,this.checkHitEnemies(),this.draw(),this.prevTimestamp=t,window.requestAnimationFrame(this.playing.bind(this))}}keyDown(t){switch(t.keyCode){case 37:case 65:this.player.newDirection="left";break;case 39:case 68:this.player.newDirection="right";break;case 38:case 87:this.player.newDirection="top";break;case 40:case 83:this.player.newDirection="down"}}keyUp(t){switch(t.keyCode){case 37:case 65:case 39:case 68:case 38:case 87:case 40:case 83:this.player.newDirection=null}}putCharacter(t){t.posY=getRandomInt(0,100),t.posX=getRandomInt(0,100),this.checkHitWall(t)&&this.putCharacter(t)}moveCharacter(t){if(null!==t.newDirection){if(t.currentDirection!==t.newDirection){const e=t.directionConst[t.currentDirection][t.newDirection];if(t.currentDirection=t.newDirection,e>0)for(let i=0;i<e;i++)t.turn()}let e=t.posX,i=t.posY;switch(t.newDirection){case"top":t.posY--;break;case"down":t.posY++;break;case"right":t.posX++;break;case"left":t.posX--}this.checkHitWall(t)&&(t.posY=i,t.posX=e)}for(let e=0;e<t.mImageData.length;e++){const i=t.posY+e;if(void 0!==this.currentFrame[i])for(let a=0;a<t.mImageData[e].length;a++){const n=t.posX+a;if(void 0===this.currentFrame[i][n])continue;let s=t.mImageData[e][a];"F"===s&&(s=this.currentFrame[i][n]),this.currentFrame[i][n]=s}}}checkHitWall(t){for(let e=0;e<t.mImageData.length;e++){const i=t.posY+e;if(void 0!==this.currentFrame[i])for(let a=0;a<t.mImageData[e].length;a++){const n=t.posX+a;if(void 0!==this.currentFrame[i][n]&&"F"!==t.mImageData[e][a]&&"A"===this.currentFrame[i][n])return!0}}return!1}checkHitEnemies(){for(let t=0;t<this.player.mImageData.length;t++)for(let e=0;e<this.player.mImageData[t].length;e++)for(let i=0;i<Object.keys(this.enemies).length;i++)for(let a=0;a<this.enemies[i].mImageData.length;a++)for(let n=0;n<this.enemies[i].mImageData[a].length;n++)if("F"!==this.player.mImageData[t][e]&&"F"!==this.enemies[i].mImageData[t][e]&&this.player.posY+t===this.enemies[i].posY+a&&this.player.posX+e===this.enemies[i].posX+n)return alert("hit!"),this.player.newDirection=null,this.putCharacter(this.player),!0;return!1}draw(){for(let t=0;t<this.currentFrame.length;t++)for(let e=0;e<this.currentFrame[t].length;e++)this.mCanvas.fillStyle=COLORS[this.currentFrame[t][e]],this.mCanvas.fillRect(e*PIXEL_SIZE,t*PIXEL_SIZE,PIXEL_SIZE,PIXEL_SIZE)}}let r,m;window.addEventListener("DOMContentLoaded",(function(){r=document.getElementById("canvas"),m=r.getContext("2d");let t=new a;r.width=t.stageWidth,r.height=t.stageHeight;let e=new s(m,t);window.requestAnimationFrame(e.playing.bind(e))}))}]);